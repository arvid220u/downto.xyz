{"version":3,"sources":["App.tsx","Verify.tsx","reportWebVitals.ts","index.tsx"],"names":["asyncFlatMap","arr","asyncFn","a","Promise","flatten","asyncMap","all","map","concat","DTF","DTC","DTD","MATCH_TYPES","MATCH_EXPLANATIONS","_arrayBufferToBase64","buffer","binary","bytes","Uint8Array","len","byteLength","i","String","fromCharCode","window","btoa","_base64ToArrayBuffer","base64","binary_string","atob","length","charCodeAt","Footer","className","href","post","path","data","url","process","console","log","fetch","method","cache","headers","body","JSON","stringify","response","getEmails","s","match","Form","props","verifiedEmail","localStorage","getItem","verifiedKey","verified","useState","email","setEmail","key","setKey","publicKey","setPublicKey","password","setPassword","affirmation","setAffirmation","targets","setTargets","useEffect","update","useCallback","alert","privateKey","typ","emailss","push","em","sessionkey","emails","t","secrets","json","sks","skss","ll","skkkkk","email1","email0","h","enc","TextEncoder","dec","TextDecoder","crypto","subtle","digest","encode","h_hash","sk_and_nonce_s","exportKey","decrypt","name","sk_and_nonce","decode","identifier","nonce","type","split","sk_s","nonce_s","sk","sk_arr","h_hash_arr","id1","id1_s","likes","publickey","resp","ok","statusText","resetEmail","removeItem","genKey","generateKey","modulusLength","publicExponent","hash","result","exp","exp_s","priv","priv_s","randVal","getRandomValues","new_pass","setItem","updateKey","newkey","pub_s","importKey","pub_key","priv_key","verifyEmail","storedKey","value","onChange","e","target","placeholder","readOnly","onClick","checked","htmlFor","App","mode","search","location","params","URLSearchParams","dtf","get","dtc","dtd","history","replaceState","document","title","pathname","Verify","navigate","encodeURIComponent","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.e9a4fd40.chunk.js","sourcesContent":["import { useCallback, useRef, useEffect, useState } from \"react\";\nimport { RouteComponentProps } from \"@gatsbyjs/reach-router\";\nimport \"./App.css\";\nimport { createSecretKey } from \"crypto\";\nasync function asyncFlatMap<T, O>(\n  arr: T[],\n  asyncFn: (t: T) => Promise<O[]>\n): Promise<O[]> {\n  return Promise.all(flatten(await asyncMap(arr, asyncFn)));\n}\n\nfunction flatMap<T, O>(arr: T[], fn: (t: T) => O[]): O[] {\n  return flatten(arr.map(fn));\n}\n\nfunction asyncMap<T, O>(arr: T[], asyncFn: (t: T) => Promise<O>): Promise<O[]> {\n  return Promise.all(arr.map(asyncFn));\n}\n\nfunction flatten<T>(arr: T[][]): T[] {\n  return ([] as T[]).concat(...arr);\n}\n\nconst DTF = \"DTF\";\nconst DTC = \"DTC\";\nconst DTD = \"DTD\";\nconst MATCH_TYPES: string[] = [DTF, DTC, DTD];\nconst MATCH_EXPLANATIONS = {\n  [DTF]: \"(fuck)\",\n  [DTC]: \"(cuddle)\",\n  [DTD]: \"(date)\",\n};\n\nfunction _arrayBufferToBase64(buffer) {\n  var binary = \"\";\n  var bytes = new Uint8Array(buffer);\n  var len = bytes.byteLength;\n  for (var i = 0; i < len; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return window.btoa(binary);\n}\n\nfunction _base64ToArrayBuffer(base64) {\n  var binary_string = window.atob(base64);\n  var len = binary_string.length;\n  var bytes = new Uint8Array(len);\n  for (var i = 0; i < len; i++) {\n    bytes[i] = binary_string.charCodeAt(i);\n  }\n  return bytes.buffer;\n}\n\nfunction Footer() {\n  return (\n    <footer>\n      <div className=\"my-2 max-w-2xl mx-auto\">\n        <h3 className=\"font-bold text-lg\">how does it work?</h3>\n        <p className=\"m-2\">\n          you enter the @mit.edu addresses of people you are down to do things\n          with. if you both indicate interest in each other for the same\n          category, you will both get an email notifying you of a match!\n        </p>\n        <h3 className=\"font-bold text-lg\">privacy</h3>\n        <p className=\"m-2\">\n          the data stored on our servers is encrypted, so you don't need to\n          worry about your list of preferences being revealed at any point\n          (assuming you trust somewhat rushed unaudited untested code).\n          information is only revealed in the event of a match. a slightly\n          unfortunate side effect of this, and the fact that MIT does not have a\n          public key directory, is that a match will not be detected if person A\n          enters their preferences for B before B has verified their email,\n          until person A comes back to this page and updates.\n        </p>\n        <p className=\"m-2\">\n          the source code is available at{\" \"}\n          <a href=\"https://github.com/arvid220u/downto.xyz\">\n            github.com/arvid220u/downto.xyz\n          </a>\n          . the readme contains a more thorough description of the exact privacy\n          protocol. feedback and pull requests are very welcome!\n        </p>\n        <h3 className=\"font-bold text-lg\">about</h3>\n        <p className=\"m-2\">\n          downto.xyz is inspired by the now-dead dildo.io. we believe that there\n          should be fewer taboos, more openness and more physical intimacy in\n          the world. while downto.xyz obviously isn't the end-all-be-all\n          solution to any of that, we hope that it can contribute to a more open\n          world, even if only by a tiny amount.\n        </p>\n        <p className=\"m-2\">\n          if you have any thoughts, positive or negative, email us at\n          downto-board@mit.edu. it is very important to us that downto.xyz is\n          good for the world, not bad, and if you have any concerns about\n          anything, please let us know.\n        </p>\n      </div>\n    </footer>\n  );\n}\n\n// Example POST method implementation:\nasync function post(path = \"\", data = {}) {\n  // Default options are marked with *\n  const url = process.env.REACT_APP_API_URL + path;\n  console.log(url);\n  const response = await fetch(url, {\n    method: \"POST\", // *GET, POST, PUT, DELETE, etc.\n    // mode: \"no-cors\", // no-cors, *cors, same-origin\n    cache: \"no-cache\", // *default, no-cache, reload, force-cache, only-if-cached\n    // credentials: 'same-origin', // include, *same-origin, omit\n    headers: {\n      \"Content-Type\": \"application/json\",\n      // 'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    // redirect: 'follow', // manual, *follow, error\n    // referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url\n    body: JSON.stringify(data), // body data type must match \"Content-Type\" header\n  });\n  console.log(response);\n  return response; // parses JSON response into native JavaScript objects\n}\n\nfunction getEmails(s) {\n  const rgx = /([^,\\s@]+@\\w+\\.\\w+)/gm;\n  const match = s.match(rgx);\n  if (!match) {\n    return [];\n  }\n  return match;\n}\n\nfunction isMitEmail(s) {\n  const rgx = /[a-z0-9_]+@mit\\.edu/gm;\n  const match = s.match(rgx);\n  if (!match) {\n    return false;\n  }\n  return true;\n}\n\ntype Targets = {\n  [DTF]: string;\n  [DTC]: string;\n  [DTD]: string;\n};\n\nfunction Form(props: { targets: Targets }) {\n  const verifiedEmail = window.localStorage.getItem(\"email\");\n  const verifiedKey = window.localStorage.getItem(\"key\");\n  const verified = verifiedEmail != null && verifiedKey != null;\n\n  const [email, setEmail] = useState(verified ? verifiedEmail : \"\");\n  const [key, setKey] = useState<CryptoKeyPair | null>(null);\n  const [publicKey, setPublicKey] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [affirmation, setAffirmation] = useState(false);\n  const [targets, setTargets] = useState(props.targets);\n\n  useEffect(() => {\n    setTargets(props.targets);\n  }, [props.targets]);\n\n  const update = useCallback(async () => {\n    if (!verified) {\n      alert(\"you must verify your email first!\");\n      return;\n    }\n    if (!key || !key.privateKey) {\n      alert(\"you need to either paste an old key or generate a new key!\");\n      return;\n    }\n    if (!affirmation) {\n      alert(\n        \"please indicate that you are honest and serious by clicking the checkbox.\"\n      );\n      return;\n    }\n    console.log(\"update :0\");\n    let emailss: [string, string][] = [];\n    for (const typ in targets) {\n      emailss.push(\n        ...getEmails(targets[typ]).map((em) => {\n          return [typ, em];\n        })\n      );\n    }\n    console.log(emailss);\n    // now get the sks for all of these\n    const secrets = await post(\"/getsecrets\", {\n      sessionkey: verifiedKey,\n      email: verifiedEmail,\n      emails: emailss.map((t) => {\n        return t[1];\n      }),\n    });\n    console.log(secrets.json());\n    // ok great, now what?\n    const likes = await asyncFlatMap(emailss, async (t: [string, string]) => {\n      const em = t[1];\n      const typ = t[0];\n      if (!key.privateKey || !key.publicKey) {\n        alert(\"somethingw rong\");\n        return [];\n      }\n      const sks = secrets.json()[em];\n      const skss = [sks[\"sk1\"], sks[\"sk2\"]];\n      let ll: {\n        identifier: string;\n        nonce: string;\n        email0: string;\n        email1: string;\n        type: string;\n      }[] = [];\n      for (const skkkkk of skss) {\n        const email0 = em > verifiedEmail ? verifiedEmail : em;\n        const email1 = email0 === em ? verifiedEmail : em;\n        const h = `${typ}${email0}${email1}`;\n        var enc = new TextEncoder();\n        var dec = new TextDecoder();\n        console.log(sks);\n        const h_hash = await crypto.subtle.digest(\"SHA-256\", enc.encode(h));\n        console.log(\"HASH:\");\n        console.log(h_hash);\n        let sk_and_nonce_s = \"\";\n        try {\n          console.log(\"encrypted SK:\");\n          console.log(skkkkk);\n          console.log(\"public key: \");\n          console.log(\n            _arrayBufferToBase64(\n              await crypto.subtle.exportKey(\"spki\", key.publicKey)\n            )\n          );\n          const sk_and_nonce = await crypto.subtle.decrypt(\n            {\n              name: \"RSA-OAEP\",\n            },\n            key.privateKey,\n            _base64ToArrayBuffer(skkkkk)\n          );\n          console.log(\"SKA AND NONCE:\");\n          console.log(sk_and_nonce);\n          sk_and_nonce_s = dec.decode(sk_and_nonce);\n        } catch (error) {\n          console.log(\"ERROR (ignoring it).....\");\n          console.log(error);\n          ll.push({\n            identifier: \"fakeidentifier\",\n            nonce: \"fakenonce\",\n            email0,\n            email1,\n            type: typ,\n          });\n          continue;\n        }\n        console.log(\"SK AND NONCE S: \");\n        console.log(sk_and_nonce_s);\n        const [sk_s, nonce_s] = sk_and_nonce_s.split(\"!\");\n        const sk = _base64ToArrayBuffer(sk_s);\n        if (h_hash.byteLength !== sk.byteLength) {\n          alert(\"smth very wrong\");\n          console.log(h_hash);\n          console.log(sk);\n          ll.push({\n            identifier: \"fakeidentifier\",\n            nonce: \"fakenonce\",\n            email0,\n            email1,\n            type: typ,\n          });\n          continue;\n        }\n        console.log(\"SK\");\n        console.log(dec.decode(sk));\n        console.log(\"H_HASH\");\n        console.log(dec.decode(h_hash));\n        const sk_arr = new Uint8Array(sk);\n        const h_hash_arr = new Uint8Array(h_hash);\n        const id1 = new Uint8Array(sk.byteLength);\n        for (var i = 0; i < id1.length; i++) {\n          id1[i] = sk_arr[i] ^ h_hash_arr[i];\n          console.log(\n            `sk[${i}] = ${sk[i]}, h_hash[]=${h_hash[i]}, id1[]=${id1[i]}`\n          );\n        }\n        console.log(\"id1\");\n        console.log(dec.decode(id1));\n        const id1_s = _arrayBufferToBase64(id1);\n        ll.push({\n          identifier: id1_s,\n          nonce: nonce_s,\n          email0,\n          email1,\n          type: typ,\n        });\n      }\n      return ll;\n    });\n    console.log(likes);\n    const resp = await post(\"/update\", {\n      sessionkey: verifiedKey,\n      email: verifiedEmail,\n      publickey: publicKey,\n      likes: likes,\n    });\n    if (resp.ok) {\n      alert(\n        \"successfully updated preferences! check your email (and in particular your junk folder)\"\n      );\n    } else {\n      alert(`unsuccessful update: ${resp.statusText}`);\n    }\n  }, [\n    email,\n    password,\n    targets,\n    verified,\n    verifiedKey,\n    verifiedEmail,\n    affirmation,\n    publicKey,\n    key,\n  ]);\n\n  const resetEmail = useCallback(() => {\n    window.localStorage.removeItem(\"email\");\n    window.localStorage.removeItem(\"key\");\n    setEmail(\"\");\n  }, []);\n  const genKey = useCallback(async () => {\n    setPassword(\"...generating key...\");\n    alert(\"save this key! you need to use the same key every time\");\n    const result = await crypto.subtle.generateKey(\n      {\n        name: \"RSA-OAEP\",\n        modulusLength: 4096,\n        publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n        hash: \"SHA-256\",\n      },\n      true,\n      [\"encrypt\", \"decrypt\"]\n    );\n    setKey(result);\n    if (!result.publicKey || !result.privateKey) {\n      alert(\"error :(\");\n      return;\n    }\n    const exp = await crypto.subtle.exportKey(\"spki\", result.publicKey);\n    const exp_s = _arrayBufferToBase64(exp);\n    setPublicKey(exp_s);\n    console.log(exp_s);\n    const priv = await crypto.subtle.exportKey(\"pkcs8\", result.privateKey);\n    const priv_s = _arrayBufferToBase64(priv);\n    console.log(priv_s);\n    let randVal = new Uint8Array(10);\n    randVal = crypto.getRandomValues(randVal);\n    const new_pass = `${_arrayBufferToBase64(randVal)}!${exp_s}!${priv_s}`;\n    setPassword(new_pass);\n    window.localStorage.setItem(\"keypair\", new_pass);\n  }, []);\n  const updateKey = useCallback(\n    async (newkey) => {\n      try {\n        setPassword(newkey);\n        const [_, pub_s, priv_s] = newkey.split(\"!\");\n        const pub_key = await crypto.subtle.importKey(\n          \"spki\",\n          _base64ToArrayBuffer(pub_s),\n          { name: \"RSA-OAEP\", hash: \"SHA-256\" },\n          true,\n          [\"encrypt\"]\n        );\n        const priv_key = await crypto.subtle.importKey(\n          \"pkcs8\",\n          _base64ToArrayBuffer(priv_s),\n          { name: \"RSA-OAEP\", hash: \"SHA-256\" },\n          true,\n          [\"decrypt\"]\n        );\n        setPublicKey(pub_s);\n        setKey({ privateKey: priv_key, publicKey: pub_key });\n        window.localStorage.setItem(\"keypair\", newkey);\n      } catch (e) {\n        setPassword(password);\n        alert(`invalid key: ${e}`);\n      }\n    },\n    [password, key, setPassword, setPublicKey, setKey]\n  );\n  const verifyEmail = useCallback(async () => {\n    if (!isMitEmail(email)) {\n      alert(\"you need to send from an mit.edu email address!\");\n      return;\n    }\n    let v = {\n      email,\n      targets,\n    };\n    post(\"/verify\", v);\n    alert(\n      \"check your email (including your junk folder) for a verification link!\"\n    );\n  }, [email, targets]);\n\n  useEffect(() => {\n    const storedKey = window.localStorage.getItem(\"keypair\");\n    if (storedKey && storedKey !== password) {\n      updateKey(storedKey);\n    }\n  }, []);\n\n  return (\n    <div className=\"Send mb-4 mx-4\">\n      <div className=\"inputrow\">\n        <input\n          type=\"email\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          placeholder=\"mykerb@mit.edu\"\n          readOnly={verified}\n        />\n        <button onClick={() => (verified ? resetEmail() : verifyEmail())}>\n          {verified ? \"change\" : \"verify\"}\n        </button>\n      </div>\n      <div className=\"inputrow\">\n        <input\n          type=\"text\"\n          value={password}\n          placeholder=\"paste old key here, or generate new \"\n          onChange={(e) => updateKey(e.target.value)}\n        />\n        <button onClick={genKey}>generate</button>\n      </div>\n      {MATCH_TYPES.map((type) => {\n        return (\n          <div className=\"inputrow\" key={`${type}1`}>\n            <div className=\"my-auto mx-auto mr-2 w-20\" key={`${type}2`}>\n              <span className=\"font-bold text-lg\" key={`${type}3`}>\n                {type}:\n              </span>\n              <br key={`${type}4`} />\n              <span key={`${type}5`} className=\"text-xs\">\n                {MATCH_EXPLANATIONS[type]}\n              </span>\n            </div>\n            <textarea\n              key={`${type}6`}\n              className=\"inputrow\"\n              placeholder=\"friend@mit.edu, friend2@mit.edu\"\n              value={targets[type]}\n              onChange={(e) =>\n                setTargets({\n                  ...targets,\n                  [type]: e.target.value,\n                })\n              }\n            />\n          </div>\n        );\n      })}\n      <div>\n        <input\n          className=\"w-3 h-3 border border-gray-300 rounded\"\n          type=\"checkbox\"\n          name=\"solemnlyswear\"\n          checked={affirmation}\n          onClick={() => setAffirmation(!affirmation)}\n        />{\" \"}\n        <label htmlFor=\"solemnlyswear\">\n          i hereby declare that i am excited to do things with the people above,\n          should we match\n        </label>\n      </div>\n      <button onClick={update}>update</button>\n      <div>(note: you can only update once every 24 hours!)</div>\n      (note 2: emails are sent immediately upon a match! so please, if so only\n      to avoid awkwardness, be honest. seriously)\n    </div>\n  );\n}\n\nfunction App(props: RouteComponentProps) {\n  const [mode, setMode] = useState(\"normal\");\n  const [targets, setTargets] = useState({} as Targets);\n\n  useEffect(() => {\n    const search = window.location.search;\n    const params = new URLSearchParams(search);\n    const dtf = params.get(\"dtf\");\n    const dtc = params.get(\"dtc\");\n    const dtd = params.get(\"dtd\");\n    setTargets({\n      [DTF]: dtf || \"\",\n      [DTC]: dtc || \"\",\n      [DTD]: dtd || \"\",\n    });\n    window.history.replaceState({}, document.title, window.location.pathname);\n  }, [mode]);\n\n  return (\n    <div className=\"App\">\n      <h1 className=\"font-bold text-xl m-2\">downto.xyz</h1>\n      <Form targets={targets} />\n      <hr />\n      <Footer />\n    </div>\n  );\n}\n\nexport default App;\n","import { navigate, Redirect, redirectTo } from \"@gatsbyjs/reach-router\";\nimport { useCallback, useRef, useEffect, useState } from \"react\";\nimport { RouteComponentProps } from \"@gatsbyjs/reach-router\";\n\nfunction Verify(props: RouteComponentProps) {\n  useEffect(() => {\n    const search = window.location.search;\n    const params = new URLSearchParams(search);\n    const email = params.get(\"u\");\n    const key = params.get(\"k\");\n    const dtf = params.get(\"dtf\");\n    const dtc = params.get(\"dtc\");\n    const dtd = params.get(\"dtd\");\n    window.history.replaceState(null, \"\", \"\");\n    window.localStorage.setItem(\"email\", email || \"\");\n    window.localStorage.setItem(\"key\", key || \"\");\n    navigate(\n      `/?dtf=${dtf ? encodeURIComponent(dtf) : \"\"}&dtc=${\n        dtc ? encodeURIComponent(dtc) : \"\"\n      }&dtd=${dtd ? encodeURIComponent(dtd) : \"\"}`\n    );\n  }, []);\n  return <div>Redirecting...</div>;\n}\n\nexport default Verify;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport Verify from \"./Verify\";\nimport { Router } from \"@gatsbyjs/reach-router\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router>\n      <App path=\"/\" />\n      <Verify path=\"/verify\" />\n    </Router>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals(null);\n"],"sourceRoot":""}