(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{18:function(e,t,n){},20:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var a,o=n(0),r=n.n(o),c=n(12),s=n.n(c),i=(n(18),n(11)),l=n(2),u=n.n(l),d=n(4),b=n(3),h=n(13),p=n(5),m=(n(20),n(1));function y(e,t){return f.apply(this,arguments)}function f(){return(f=Object(p.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Promise,e.t1=g,e.next=4,j(t,n);case 4:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.abrupt("return",e.t0.all.call(e.t0,e.t3));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return Promise.all(e.map(t))}function g(e){var t;return(t=[]).concat.apply(t,Object(h.a)(e))}var w="DTF",x="DTC",O="DTD",v=[w,x,O],k=(a={},Object(b.a)(a,w,"(fuck)"),Object(b.a)(a,x,"(cuddle)"),Object(b.a)(a,O,"(date)"),a);function S(e){for(var t="",n=new Uint8Array(e),a=n.byteLength,o=0;o<a;o++)t+=String.fromCharCode(n[o]);return window.btoa(t)}function N(e){for(var t=window.atob(e),n=t.length,a=new Uint8Array(n),o=0;o<n;o++)a[o]=t.charCodeAt(o);return a.buffer}function C(){return Object(m.jsx)("footer",{children:Object(m.jsxs)("div",{className:"my-2 max-w-2xl mx-auto",children:[Object(m.jsx)("h3",{className:"font-bold text-lg",children:"how does it work?"}),Object(m.jsx)("p",{className:"m-2",children:"you enter the @mit.edu addresses of people you are down to do things with. if you both indicate interest in each other for the same category, you will both get an email notifying you of a match!"}),Object(m.jsx)("h3",{className:"font-bold text-lg",children:"privacy"}),Object(m.jsx)("p",{className:"m-2",children:"the data stored on our servers is encrypted, so you don't need to worry about your list of preferences being revealed at any point (assuming you trust somewhat rushed unaudited untested code). information is only revealed in the event of a match. a slightly unfortunate side effect of this, and the fact that MIT does not have a public key directory, is that a match will not be detected if person A enters their preferences for B before B has verified their email, until person A comes back to this page and updates."}),Object(m.jsxs)("p",{className:"m-2",children:["the source code is available at"," ",Object(m.jsx)("a",{href:"https://github.com/arvid220u/downto.xyz",children:"github.com/arvid220u/downto.xyz"}),". the readme contains a more thorough description of the exact privacy protocol. feedback and pull requests are very welcome!"]}),Object(m.jsx)("h3",{className:"font-bold text-lg",children:"about"}),Object(m.jsx)("p",{className:"m-2",children:"downto.xyz is inspired by the now-dead dildo.io. we believe that there should be fewer taboos, more openness and more physical intimacy in the world. while downto.xyz obviously isn't the end-all-be-all solution to any of that, we hope that it can contribute to a more open world, even if only by a tiny amount."}),Object(m.jsx)("p",{className:"m-2",children:"if you have any thoughts, positive or negative, email us at downto-board@mit.edu. it is very important to us that downto.xyz is good for the world, not bad, and if you have any concerns about anything, please let us know."})]})})}function A(){return K.apply(this,arguments)}function K(){return K=Object(p.a)(u.a.mark((function e(){var t,n,a,o,r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",n=r.length>1&&void 0!==r[1]?r[1]:{},a="https://api.downto.xyz"+t,console.log(a),e.next=6,fetch(a,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 6:return o=e.sent,console.log(o),e.abrupt("return",o.json());case 9:case"end":return e.stop()}}),e)}))),K.apply(this,arguments)}function I(e){var t=e.match(/([^,\s@]+@\w+\.\w+)/gm);return t||[]}function E(e){var t=window.localStorage.getItem("email"),n=window.localStorage.getItem("key"),a=null!=t&&null!=n,r=Object(o.useState)(a?t:""),c=Object(d.a)(r,2),s=c[0],l=c[1],h=Object(o.useState)(null),f=Object(d.a)(h,2),j=f[0],g=f[1],w=Object(o.useState)(""),x=Object(d.a)(w,2),O=x[0],C=x[1],K=Object(o.useState)(""),E=Object(d.a)(K,2),R=E[0],T=E[1],L=Object(o.useState)(e.targets),P=Object(d.a)(L,2),U=P[0],z=P[1];Object(o.useEffect)((function(){z(e.targets)}),[e.targets]);var D=Object(o.useCallback)(Object(p.a)(u.a.mark((function e(){var o,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=3;break}return alert("you must verify your email first!"),e.abrupt("return");case 3:if(j&&j.privateKey){e.next=6;break}return alert("you need to either paste an old key or generate a new key!"),e.abrupt("return");case 6:return console.log("update :0"),o=I(U.DTF),console.log(o),e.next=11,A("/getsecrets",{sessionkey:n,email:t,emails:o});case 11:return r=e.sent,console.log(r),e.next=15,y(o,function(){var e=Object(p.a)(u.a.mark((function e(n){var a,o,c,s,i,l,b,h,p,m,y,f,g,w,x,O,v,k,C,A,K;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j.privateKey&&j.publicKey){e.next=3;break}return alert("somethingw rong"),e.abrupt("return",[]);case 3:a=r[n],o=[a.sk1,a.sk2],c=[],s=0,i=o;case 7:if(!(s<i.length)){e.next=61;break}return l=i[s],h=(b=n>t?t:n)===n?t:n,p="".concat(b).concat(h),m=new TextEncoder,console.log(a),e.next=16,crypto.subtle.digest("SHA-256",m.encode(p));case 16:return y=e.sent,console.log("HASH:"),console.log(y),f="",e.prev=20,console.log("encrypted SK:"),console.log(l),console.log("public key: "),e.t0=console,e.t1=S,e.next=28,crypto.subtle.exportKey("spki",j.publicKey);case 28:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t0.log.call(e.t0,e.t3),e.next=33,crypto.subtle.decrypt({name:"RSA-OAEP"},j.privateKey,N(l));case 33:g=e.sent,console.log("SKA AND NONCE:"),console.log(g),f=S(g),e.next=45;break;case 39:return e.prev=39,e.t4=e.catch(20),console.log("ERROR (ignoring it)....."),console.log(e.t4),c.push({identifier:"fakeidentifier",nonce:"fakenonce",email0:b,email1:h}),e.abrupt("continue",58);case 45:if(console.log("SK AND NONCE S: "),console.log(f),w=f.split("!"),x=Object(d.a)(w,2),O=x[0],v=x[1],k=N(O),y.byteLength===k.byteLength){e.next=54;break}return alert("smth very wrong"),console.log(y),console.log(k),e.abrupt("return",[]);case 54:for(C=new Uint8Array(k.byteLength),A=0;A<C.length;A++)C[A]=k[A]^y[A];K=S(C),c.push({identifier:K,nonce:v,email0:b,email1:h});case 58:s++,e.next=7;break;case 61:return e.abrupt("return",c);case 62:case"end":return e.stop()}}),e,null,[[20,39]])})));return function(t){return e.apply(this,arguments)}}());case 15:c=e.sent,console.log(c),A("/update",{sessionkey:n,email:t,publickey:O,likes:c});case 18:case"end":return e.stop()}}),e)}))),[s,R,U,a,n]),F=Object(o.useCallback)((function(){window.localStorage.removeItem("email"),window.localStorage.removeItem("key"),l("")}),[]),B=Object(o.useCallback)(Object(p.a)(u.a.mark((function e(){var t,n,a,o,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("save this key! you need to use the same key every time"),e.next=3,crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]);case 3:if(t=e.sent,g(t),t.publicKey&&t.privateKey){e.next=8;break}return alert("error :("),e.abrupt("return");case 8:return e.next=10,crypto.subtle.exportKey("spki",t.publicKey);case 10:return n=e.sent,a=S(n),C(a),console.log(a),e.next=16,crypto.subtle.exportKey("pkcs8",t.privateKey);case 16:o=e.sent,r=S(o),console.log(r),T("".concat(a).concat(r));case 20:case"end":return e.stop()}}),e)}))),[]),H=Object(o.useCallback)(Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.match(/[a-z0-9_]+@mit\.edu/gm)){e.next=3;break}return alert("you need to send from an mit.edu email address!"),e.abrupt("return");case 3:A("/verify",{email:s,targets:U}),alert("check your email for a verification link!");case 6:case"end":return e.stop()}}),e)}))),[s,U]);return Object(m.jsxs)("div",{className:"Send mb-4 mx-4",children:[Object(m.jsxs)("div",{className:"inputrow",children:[Object(m.jsx)("input",{type:"email",value:s,onChange:function(e){return l(e.target.value)},placeholder:"mykerb@mit.edu",readOnly:a}),Object(m.jsx)("button",{onClick:function(){return a?F():H()},children:a?"change":"verify"})]}),Object(m.jsxs)("div",{className:"inputrow",children:[Object(m.jsx)("input",{type:"text",value:R,placeholder:"paste old key here, or generate new ",onChange:function(e){return T(e.target.value)}}),Object(m.jsx)("button",{onClick:B,children:"generate"})]}),v.map((function(e){return Object(m.jsxs)("div",{className:"inputrow",children:[Object(m.jsxs)("div",{className:"my-auto mx-auto mr-2 w-20",children:[Object(m.jsxs)("span",{className:"font-bold text-lg",children:[e,":"]},"".concat(e,"3")),Object(m.jsx)("br",{},"".concat(e,"4")),Object(m.jsx)("span",{className:"text-xs",children:k[e]},"".concat(e,"5"))]},"".concat(e,"2")),Object(m.jsx)("textarea",{className:"inputrow",placeholder:"friend@mit.edu, friend2@mit.edu",value:U[e],onChange:function(t){return z(Object(i.a)(Object(i.a)({},U),{},Object(b.a)({},e,t.target.value)))}},"".concat(e,"6"))]},"".concat(e,"1"))})),Object(m.jsxs)("div",{children:[Object(m.jsx)("input",{className:"w-3 h-3 border border-gray-300 rounded",type:"checkbox",name:"solemnlyswear"})," ",Object(m.jsx)("label",{htmlFor:"solemnlyswear",children:"i hereby declare that i am excited to do things with the people above, should we match"})]}),Object(m.jsx)("button",{onClick:D,children:"update"}),Object(m.jsx)("div",{children:"(note: you can only update once every 24 hours!)"}),"(note 2: emails are sent immediately upon a match! so please, if so only to avoid awkwardness, be honest. seriously)"]})}var R=function(e){var t=Object(o.useState)("normal"),n=Object(d.a)(t,2),a=n[0],r=(n[1],Object(o.useState)({})),c=Object(d.a)(r,2),s=c[0],i=c[1];return Object(o.useEffect)((function(){var e,t=window.location.search,n=new URLSearchParams(t),a=n.get("dtf"),o=n.get("dtc"),r=n.get("dtd");i((e={},Object(b.a)(e,w,a||""),Object(b.a)(e,x,o||""),Object(b.a)(e,O,r||""),e)),window.history.replaceState({},document.title,window.location.pathname)}),[a]),Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)("h1",{className:"font-bold text-xl m-2",children:"downto.xyz"}),Object(m.jsx)(E,{targets:s}),Object(m.jsx)("hr",{}),Object(m.jsx)(C,{})]})},T=n(9);var L=function(e){return Object(o.useEffect)((function(){var e=window.location.search,t=new URLSearchParams(e),n=t.get("u"),a=t.get("k"),o=t.get("dtf"),r=t.get("dtc"),c=t.get("dtd");window.history.replaceState(null,"",""),window.localStorage.setItem("email",n||""),window.localStorage.setItem("key",a||""),Object(T.b)("/?dtf=".concat(o?encodeURIComponent(o):"","&dtc=").concat(r?encodeURIComponent(r):"","&dtd=").concat(c?encodeURIComponent(c):""))}),[]),Object(m.jsx)("div",{children:"Redirecting..."})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,26)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),o(e),r(e),c(e)}))};s.a.render(Object(m.jsx)(r.a.StrictMode,{children:Object(m.jsxs)(T.a,{children:[Object(m.jsx)(R,{path:"/"}),Object(m.jsx)(L,{path:"/verify"})]})}),document.getElementById("root")),P(null)}},[[25,1,2]]]);
//# sourceMappingURL=main.73cb7528.chunk.js.map